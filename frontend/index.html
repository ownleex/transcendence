<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transcendence - Sign In</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    // --- THEME SETUP ---
    if (localStorage.theme === 'dark' ||
        (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    function toggleTheme() {
      const html = document.documentElement;
      if (html.classList.contains('dark')) {
        html.classList.remove('dark');
        localStorage.theme = 'light';
      } else {
        html.classList.add('dark');
        localStorage.theme = 'dark';
      }
    }

    // --- PAGE SWITCHING ---
    function showSection(section) {
      // hide all known sections
      const ids = ['signin-section', 'register-section', 'forgot-section', 'reset-section', 'pong-section'];
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
      });
      // show requested section
      const target = document.getElementById(section);
      if (target) target.classList.remove('hidden');
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Navbar links
      document.getElementById('link-signin').addEventListener('click', (e) => {
        e.preventDefault();
        showSection('signin-section');
      });

      document.getElementById('link-signup').addEventListener('click', (e) => {
        e.preventDefault();
        showSection('register-section');
      });

      // Inside Sign-in form -> goto Register
      document.getElementById('goto-register').addEventListener('click', (e) => {
        e.preventDefault();
        showSection('register-section');
      });

      // Sign-up -> goto Signin
      document.getElementById('goto-signin').addEventListener('click', (e) => {
        e.preventDefault();
        showSection('signin-section');
      });

      // Forgot password link -> show forgot section
      document.getElementById('forgot-link').addEventListener('click', (e) => {
        e.preventDefault();
        // prefill email from username/email field if possible
        const signinForm = document.getElementById('signin-form');
        const emailOrUser = signinForm ? signinForm.querySelector('input[name="user"]') : null;
        const forgotEmail = document.getElementById('forgot-email');
        if (emailOrUser && forgotEmail) {
          forgotEmail.value = emailOrUser.value || '';
        }
        showSection('forgot-section');
      });

     // Forgot form submit -> real API call

document.getElementById('forgot-form').addEventListener('submit', async (e) => {
  e.preventDefault();
  const email = document.getElementById('forgot-email').value.trim();
  const msg = document.getElementById('forgot-message');

  if (!email) {
    msg.textContent = 'Please enter your email.';
    msg.className = 'mt-3 text-sm text-red-600 dark:text-red-400';
    return;
  }

  try {
    const response = await fetch('https://localhost:3000/api/auth/forgot', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email }),
    });

    const data = await response.json();

    if (response.ok) {
      msg.textContent = data.message || 'Email sent successfully!';
      msg.className = 'mt-3 text-sm text-green-600 dark:text-green-400';
    } else {
      msg.textContent = data.error || 'Failed to send email.';
      msg.className = 'mt-3 text-sm text-red-600 dark:text-red-400';
    }
  } catch (err) {
    console.error('Error sending email:', err);
    msg.textContent = 'Network error ‚Äî please try again.';
    msg.className = 'mt-3 text-sm text-red-600 dark:text-red-400';
  }
 });

      // Back to sign-in from forgot section
      document.getElementById('back-to-signin').addEventListener('click', (e) => {
        e.preventDefault();
        // clear message & email
        const msg = document.getElementById('forgot-message');
        const forgotEmail = document.getElementById('forgot-email');
        if (msg) { msg.textContent = ''; msg.className = 'mt-3 text-sm text-gray-600 dark:text-gray-400'; }
        if (forgotEmail) forgotEmail.value = '';
        showSection('signin-section');
      });

       // ‚úÖ Detect /reset-password?token=... and show reset form
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');
  if (token && window.location.pathname === '/reset-password') {
    showSection('reset-section');
    document.getElementById('reset-form').dataset.token = token;
  }

  // Reset form submit
  document.getElementById('reset-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const form = e.target;
    const token = form.dataset.token;
    const newPassword = document.getElementById('new-password').value.trim();
    const msg = document.getElementById('reset-message');

    if (!newPassword) {
      msg.textContent = 'Please enter a new password.';
      msg.className = 'mt-3 text-sm text-red-600';
      return;
    }

    try {
      const response = await fetch('https://localhost:3000/api/auth/reset', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, newPassword }),
      });
      const data = await response.json();
      if (response.ok) {
        msg.textContent = 'Password reset successful! You can now sign in.';
        msg.className = 'mt-3 text-sm text-green-600';
      } else {
        msg.textContent = data.error || 'Failed to reset password.';
        msg.className = 'mt-3 text-sm text-red-600';
      }
    } catch (err) {
      msg.textContent = 'Network error ‚Äî please try again.';
      msg.className = 'mt-3 text-sm text-red-600';
    }
  });
      // Show Pong section after "Sign in"
      document.getElementById('signinBtn').addEventListener('click', (e) => {
        e.preventDefault();
        // Hide Sign In / Register
        document.getElementById('signin-section').classList.add('hidden');
        document.getElementById('register-section').classList.add('hidden');
        // Show Pong dashboard
        document.getElementById('pong-section').classList.remove('hidden');
      });
    });
  </script>

</head>

<body class="bg-gradient-to-br from-gray-100 to-white dark:from-gray-900 dark:to-gray-800 flex flex-col justify-center items-center min-h-screen transition-all duration-500 relative">

  <!-- Top Bar -->
  <div class="absolute top-5 left-6 text-xl font-semibold text-gray-800 dark:text-gray-100 select-none">
    Transcendence
  </div>

  <!-- Navbar -->
  <div class="absolute top-5 right-6 flex items-center space-x-3">
    <button onclick="toggleTheme()" class="px-3 py-2 rounded-lg border dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition">
      üåì
    </button>
    <a href="#" id="link-signup" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700 transition">Sign up</a>
    <a href="#" id="link-signin" class="px-4 py-2 rounded-lg bg-blue-500 text-white text-sm hover:bg-blue-600 transition">Sign in</a>
  </div>

  <!-- SIGN IN SECTION -->
  <section id="signin-section" class="bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-8 w-80 sm:w-96 text-center transition-all duration-500">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-100">Sign in</h2>

    <form id="signin-form">
      <input name="user" type="text" placeholder="Username or email"
        class="w-full mb-3 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required>
      <input name="password" type="password" placeholder="Password"
        class="w-full mb-3 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required>

      <div class="flex justify-between text-sm mb-4">
        <a href="#" id="goto-register" class="text-blue-500 hover:underline">Don't have an account?</a>
        <!-- updated: added id="forgot-link" -->
        <a href="#" id="forgot-link" class="text-blue-500 hover:underline">Forgot password?</a>
      </div>

      <button type="button" id="signinBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition">Sign in</button>

      <div class="my-3 text-gray-500 dark:text-gray-400 text-sm">or</div>

     <a href="https://localhost:3000/api/auth/github/login"
   class="w-full flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-700 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition">
  <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg" class="w-5" alt="GitHub logo">
  Sign in with GitHub
</a>
      <a href="https://localhost:3000/api/auth/signin"
        class="w-full flex items-center justify-center gap-2 border border-gray-300 dark:border-gray-700 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 mt-2 transition">
        <img
          src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='14' fill='%23007ACC'/><text x='50' y='62' font-size='42' text-anchor='middle' fill='white' font-family='system-ui,Arial,sans-serif'>42</text></svg>"
          class="w-5 h-5" alt="42 logo">
        Sign in with 42 Intra
      </a>
    </form>

  </section>

  <!-- SIGN UP SECTION -->
  <section id="register-section" class="hidden bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-8 w-80 sm:w-96 text-center transition-all duration-500">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-100">Sign up</h2>

    <form id="register-form" class="flex flex-col gap-3">
      <input id="username" type="text" placeholder="Username"
        class="border p-2 rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required />
      <input id="email" type="email" placeholder="Email"
        class="border p-2 rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required />
      <input id="password" type="password" placeholder="Password"
        class="border p-2 rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required />
      <button type="submit" class="bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Sign up</button>
    </form>

    <p id="register-message" class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400"></p>
    <p class="text-sm mt-3 text-gray-500 dark:text-gray-400">Already have an account?
      <a href="#" id="goto-signin" class="text-blue-500 hover:underline">Sign in</a>
    </p>

  </section>

  <!-- FORGOT PASSWORD SECTION -->
  <section id="forgot-section" class="hidden bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-8 w-80 sm:w-96 text-center transition-all duration-500">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800 dark:text-gray-100">Reset password</h2>

    <form id="forgot-form" class="flex flex-col gap-3">
      <label for="forgot-email" class="sr-only">Email address</label>
      <input id="forgot-email" type="email" placeholder="Enter your email"
        class="border p-2 rounded dark:bg-gray-800 dark:border-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-400" required />

      <button type="submit" class="bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition">Send reset link</button>

      <p id="forgot-message" class="mt-3 text-sm text-gray-600 dark:text-gray-400"></p>

      <button id="back-to-signin" class="mt-4 text-sm text-gray-500 dark:text-gray-400 hover:underline">‚Üê Back to sign in</button>
    </form>
  </section>

<section id="reset-section" class="hidden">
  <h2>Reset Password</h2>
  <form id="reset-form">
    <input type="password" id="new-password" placeholder="New password" required />
    <button type="submit">Reset Password</button>
    <p id="reset-message" class="mt-3 text-sm"></p>
  </form>
</section>

  <!-- PONG DASHBOARD SECTION -->
  <section id="pong-section" class="hidden flex-col w-full min-h-screen bg-gray-100 dark:bg-gray-900 transition-all duration-500">

    <!-- Header / Navigation -->
    <header class="p-4 w-full bg-gray-800 flex justify-center gap-4 shadow-md">
      <button id="homeBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded transition">Home</button>
      <button id="tournamentBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded transition">Tournament</button>
      <button id="playersBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded transition">Players</button>
      <button id="matchesBtn" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded transition">Matches</button>
    </header>

    <!-- Main Content -->
    <main class="flex-1 p-6 text-gray-800 dark:text-gray-100">
      <h1 class="text-3xl font-bold mb-4">Welcome to Pong Dashboard!</h1>
      <p>Here you can manage tournaments, players, and matches.</p>
    </main>

    <!-- Footer -->
    <footer class="w-full text-center text-gray-400 py-4 mt-auto border-t border-gray-700">
      Transcendence 42 &copy; 2025 ‚Äî Game Management Dashboard
    </footer>

  </section>

  <!-- Scripts at the end for Vite-friendly imports -->
  <script type="module" src="./src/alias.ts"></script>
  <script type="module" src="./src/main.ts"></script>

</body>
</html>
